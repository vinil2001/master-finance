- при создании платежа, по submit - проверять в контроллере счета на вовпадение по номеру, компании и дате счета.
При совпадении выводить сообщение о том что такой счет уже ранее добавлялся в оплату и предложить перейти на страницу с этим счетом 
или на вернуться на страницу создания платежа

- октрытие файлов odt 
- при заливке файлов проверять их формат, если он не поддерживатеся сообзать об этом пользователю и не сохранять файл

- Механизм снятия счета с оплаты (если к примеру изменился уже оплаченный счет и необ.снять его с оплаты и добпаить новую).
При клике по чекбоксу (польз.admin) - PaymentPaymentDone отправлять Ajax запрос в контроллер PaymentStatement.
Если в бд finance платеж проведен вернуть сообщение пользователю о том что снимается с оплаты проведенный в Оресте платеж.
Поле paymentStatement.PaymentDone установить в false, сохранить изменения в bd.
Если по клику на чекбоксу PaymentPaymentDone в базе стоит false то никаких изменений не вносим и сообщ.
пользователю что данная отметка будет установленна автоматически


- Запретить удаление проверенного или подтвержденного платежа в finance для всех пользоватлей кроме boss и admin 

- Запрет удаления платежа если он проверен
- валидация полей create/ edite PaymentStatements
- PaymentStatements Edite - сделать возможность добавлять сразу много файлов


PaymentStatement Create при не валидной моделе возвращаются не все платежи
- Добавить поле Банк, создать справочник банков с возможностью добавления логотипа. 
- Сделать сортировку по номеру и по дате оплаты;
- В прогресс баре нипасть - проверен
- В Edite - крестик удаления расположить напротив имени ново-добавленного файла. Сделать возможность удалять ранее добавленные файлы.
- Кнопку добавить платеж рсполодить на всю длинну так же как Открыть файл.
- В Edite выводить информацию о том кто  и когда добавил, кто и когда внес последние измения и дату оплаты по каждой оплате
- Создать возможность отслеживать получен ли товар (по приходным накладным из БД ОРЕСТ).  
	Как только в ОРЕСТе появляется новая приходная накладная, изменять стату доставки в финансах (не доставлен, доставлен частично, доставлен полностью).
- Проверить редактирование платежей для USER.
- В калькуляции листовых деталей сделать выбор поставщика. Привязать к каждой оплате калькуляцию. Что бы 
при можно было посмотреть стоимость деталей прямо из платежа. Так же при создании платежа сделать возможность перейти в расчет цен на детали.
- Ломается верстка при Create, если форма не валидируется в контроллере и возвращает в представление.


Изменения 10.09.19 в:

- Реализовать выпадающий список с состояниями сделки (создать справочник типов сделки): 
Ожидаем поставку на склад поставщика, Оприходован, Частично оприходован.
Реализовать маркировку цветом тех для каждого статуса. Отображать цветную точку на против каждого счета 
(в соответсвии с цветом статуса, устанавливать который можно при создании нового статуса).
Если InvoiceCheched == false цвет точки - отсутствует.
- Записывать дату когда была проведена оплата. Сделать сортировку по дате оплаты.
- Записывать и выводить кто последний редактировал документ (создать для каждого польз.свой акаунт).
- Записывать кто ставит галочки и когда.
- Отправка смс при оплате счета

FileViewer:
- Реализовать возможность удаления (и может добавления новых???) файлов непосредственно из представления.


MySql.Data.MySqlClient.MySqlException: 'There is already an open DataReader associated with this Connection which must be closed first.'

Note that while a DataReader is open, the Connection is in use exclusively by that DataReader. You cannot execute any commands for the Connection, including creating another DataReader, until the original DataReader is closed.

https://www.lucidchart.com/documents/edit/313818e0-2450-4c37-bfc5-0278150b9413/0

*******************************************************************************************************


- Если пользователь полностью впечтал самостоятельно корректное название компании,
она не получит KltId, так как это происходит только в случае выбора компании из списка.
Нужно в перехваченном событии Submit, проверить в случае отсутствие $('#KltId').val()
наличие компании в базе каким-то ajax-запросом. 

- Если при создании PaymentStatement выбрать правильную компанию, а затем исправить её название на
неправильное - оно будет продолжить считаться корректным, так как остаётся старый KltId (????)
*******************************************************************************************************
- Вместо удаления компаний сделать их перемещение в архив.
Сделать нов.таблицу в бд. Finance где будут храниться id архивных комп.
https://www.google.com.ua/search?client=opera&hs=p3f&ei=lX51W5fiIMHe6QSWsb2IBg&q=исключить+элементы+одного+списка+из+другого+C%23&oq=исключить+элементы+одного+списка+из+другого+C%23&gs_l=psy-ab.3...7324.8909.0.9330.3.3.0.0.0.0.176.421.0j3.3.0..3..0...1.1.64.psy-ab..0.1.136...33i160k1.0.xzHznd2lrMU
- Сделать раздел - управления пользователями!!! (Изменение ролей, логинов, паролей) 

- Поиск по имени компании, номеру счета, дате счета, коментарию;???

- добавить статус - "Состояние сделки". С выбором возможных состояний: 
	-Доставлен и оприходован на склад, 
	-Частичная поставка, 
	-Ожидается поступление на склад поставщика и др.	
Создать справочник "Состояния сделок", с возможностью добавления и редактирования статусов.
В момент добавления статуса к сделке сделать возможность приписывать краткий комментарий, напр:  Частичная поставка: "Не доставили позиции ...., обещают довезти 20.05.18"
Записывать и показывать дату изменения стауса или комментария к нему.

- добавить выбор валюты и справочник валют - тянуть валюту из OrestDb;

//Debug.Log() - использовать !!!
//Global.asax.cs
//Отслеживание входа в аккаунт стартует в homecontroller


- Загрузка файлов с помощью перетаскивания
- Редактирование PaymentStatement Edit -> добавить возможность перезаливки файла, в уже созданный ранее Платеж. Проверить если платеж ранее был подписан, вывести сообщение о том что редктирование запрещено.
	
- На форме создания прихода при добавлении контрагента, банка и т.д. новые значения должны
быть подставлены в соответствующие поля после закрытия модального окна. 

- При удалении контрагента, проверить есть ли по нему операции (Приход или Расход), если есть то сообщить пользователю о том 
  что удаление не возможно из-за того что по данному пользователю ранее выполнялись операции. И предложить перенести
  пользователя в архив;
- Создать справичники: Банки, Контрагенты(Плательщик/Получатель), Форма оплаты, Категория, Статья/Тип
- Импортировать данные из базы orest (делать импорт в онлайн режиме каждый раз при обращении к справочникам):
	Банки, Контрагенты(Плательщик/Получатель), Форма оплаты, Категория, Статья/Тип 
	Данные подключения к БД orest:
server=185.67.3.212;user id=admin_orest;password=Z3Q0qaY2qdvMGbU9;database=orest;

- Импорт "Банка прихода", Банка расхода и Кассы прихода:

Таблица ksh - касса приход
Таблица bkh - банк приход

Таблица bkh - банк приход с значением в tp = 2
IncomingData -> datd
BankId -> bank (найти таблицу с банками)
CounterpartyId - klt (связать с таблицой клиентов)
IncomingSum - sd
IncomingCategoryId - отсутствует
InvoiceNumber - nsht
InvoiceData - ? дата есть в номере счёта, возможно в связи с другой таблицей
WayOfPaymentId - банк-приход
WayOfPaymentId - банк-приход

// В таблице bkn находятся такие типы записей (различающиеся полем tp):
    // 1) Банк-приход (перевод внутри старны в грн) - bkh.tp = 1;
    // 2) Банк-приход валюты при экспортных операциях - bkh.tp = 5;
    // 3) Банк-расход (перевод внутри старны в грн) - bkh.tp = 2;
    // 4) Банк-расход валюты при импортных операциях - bkh.tp = 4; 3 - заявка на покупку валюты на основе которой создается Банк-расход
    // 5) Отгрузка без 100% оплаты экспорт - bkh.tp = 6; -- пока только в двух случаях
    // У кассы-прихода ksh.tp = 1 !!!
    // Учитывая выше указанную расшифровку мне надо выбрать записи где bkh.tp = 1 || bkh.tp =5
    // tp - судя по всему имеет связь с таблицей _fin или fin или fin0 (одинаковые таблицы)
    // Только таблицы с именами _fin или fin или fin0 имеют 6 рядков - совпадающих по кол-ву с кол-м типов операций tp
    /*
     SELECT  TABLE_NAME, TABLE_ROWS
     FROM information_schema.TABLES



SELECT  bkh.id AS BankIncomingId, bkh.ndoc AS DocumentNumbeInOrestDb, bkh.curs AS CurrencyRate, NULL AS PaymentSum, bkh.sd AS TotalPaymentSumm, bkh.ncht AS InvoiceNumber, bkh.datd AS DocumentCreated, bkh.dusr AS DucumentEdited, 
                   bkh.klt AS PayerId, bkh.comt AS Comment, klt.name AS NameKlt, bank.name AS NameBank, '0' AS type
FROM      bkh INNER JOIN
                   klt ON bkh.klt = klt.id INNER JOIN
                   bank ON bkh.bank = bank.id
UNION
SELECT  ksh.id AS KassaIncomingId, ksh.ndoc AS DocumentNumbeInOrestDb, ksh.curs AS CurrencyRate, ksh.sm AS PaymentSum, ksh.sd AS TotalPaymentSumm, ksh.ncht AS InvoiceNumber, ksh.datd AS DocumentCreated, ksh.dusr AS DucumentEdited, 
                   ksh.klt AS PayerId, ksh.comt AS Comment, klt_1.name AS NameKlt, NULL AS NameBank, '1' AS type
FROM      ksh INNER JOIN
                   klt klt_1 ON ksh.klt = klt_1.id

finance@orest.ua - Finance1
anton@orest.ua - Anton2018
boss@orest.ua - Leonid1955
user@user.ua - User123
admin@orest.ua - Turizas1979

Счет формируется из таблиц rsh, tp, rsp

Перепроверить и убрать лишнее из логики формирования статусов у Платежей (invoice),
т.к. теперь статус платежа формируется исходят из статусов частиынх платежей в нём. 

Возможные конфликтные ситуации между Орестом и Финансом:
- В Оресте создан счёт, а в Финансах нет. 
- В оресте проведённый создан платёж, а в Финансах нет. +
- В Оресте снята проводка с платежа, и в Финансах платежа нет
- В Оресте снята проводка с платежа, но в Финансах платеж есть
